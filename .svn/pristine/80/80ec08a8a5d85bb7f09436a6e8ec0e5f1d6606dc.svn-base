<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xr.mapper.HolderRetireMapper" >
  <resultMap id="BaseResultMap" type="com.xr.entry.HolderRetire" >
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="HolderNo" property="holderno" jdbcType="VARCHAR" />
    <result column="HolderName" property="holdername" jdbcType="VARCHAR" />
    <result column="SexName" property="sexname" jdbcType="VARCHAR" />
    <result column="Rank" property="rank" jdbcType="VARCHAR" />
    <result column="UnitNo" property="unitno" jdbcType="VARCHAR" />
    <result column="UnitName" property="unitname" jdbcType="VARCHAR" />
    <result column="IDCode" property="idcode" jdbcType="VARCHAR" />
    <result column="StartDate" property="startdate" jdbcType="TIMESTAMP" />
    <result column="EndDate" property="enddate" jdbcType="TIMESTAMP" />
     <result column="Reason" property="reason" jdbcType="VARCHAR" />
    <result column="CreateDate" property="createdate" jdbcType="TIMESTAMP" />
    <result column="CreatePerson" property="createperson" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    ID, HolderNo, HolderName, SexName, Rank, UnitNo, UnitName, IDCode, StartDate, EndDate, 
    Reason,CreateDate, CreatePerson
  </sql>
  
   <sql id="c_start">
		select res.*
		from (select @num := @num+1 tindex, tmp.* from
		(
	</sql>

	<sql id="c_end">
		) tmp , (SELECT @num := 0) var order by id desc) res where 1=1
		<if test="curpage != null and curpage != ''">
			and res.tindex &gt;= (CONVERT(#{curpage},SIGNED)-1) *
			CONVERT(#{pagesize},SIGNED)+1
			and res.tindex &lt;=
			CONVERT(#{curpage},SIGNED) *
			CONVERT(#{pagesize},SIGNED)
		</if>
	</sql>
  
  
  <insert id="add" parameterType="Map">
    insert into HolderRetire(holderno,holdername,sexname,rank,unitno,unitname,idcode,
    startdate,enddate,reason,createdate,createperson)
    select h.holderno,h.holdername,h.sexname,h.rank,h.unitno,ul.unitname,h.idcode,
    h.startdate,h.enddate,#{reason},now(),#{loginid}  from HolderData h 
    left join UnitList ul on h.unitno=ul.unitno where h.holderno=#{holderno};
    delete from HolderData where holderno=#{holderno};
  </insert>
  
  <select id="getList" resultType="Map">
  <include refid="c_start"></include>
      select id, holderno,holdername,unitno,unitname,rank,
      sexname,idcode, 
      date_format(startdate,'%Y-%m-%d') startdate,
      date_format(enddate,'%Y-%m-%d')  enddate
       from HolderRetire 
      <where>
      <if test="id != null and id!='' " >
        and id=#{id}
      </if>
      <if test="holderno != null and holderno!='' " >
        and HolderNo=#{holderno}
      </if>
      <if test="holdername != null and holdername!='' " >
         and HolderName=#{holdername}
      </if>
      <if test="name != null and name!='' " >
         and HolderName like concat('%',#{name},'%')
      </if>
      <if test="unitno != null and unitno!='' " >
         and UnitNo=#{unitno}
      </if>
      <if test="date1 != null and date1!='' " >
         and date_format(enddate,'%Y-%m-%d')&gt;=#{date1}
      </if>
      <if test="date2 != null and date2!=''" >
         and date_format(enddate,'%Y-%m-%d') &lt;=#{date2}
      </if>
      </where>
      <include refid="c_end"></include>
  </select>
  
  <select id="getListCount" resultType="Integer">
      select count(1)  from HolderRetire
       <where>
      <if test="holderno != null and holderno!='' " >
        and HolderNo=#{holderno}
      </if>
      <if test="holdername != null and holdername!='' " >
         and HolderName=#{holdername}
      </if>
      <if test="name != null and name!='' " >
         and HolderName like concat('%',#{name},'%')
      </if>
      <if test="unitno != null and unitno!='' " >
         and UnitNo=#{unitno}
      </if>
      <if test="date1 != null and date1!='' " >
         and date_format(enddate,'%Y-%m-%d')&gt;=#{date1}
      </if>
      <if test="date2 != null and date2!=''" >
         and date_format(enddate,'%Y-%m-%d') &lt;=#{date2}
      </if>
      </where>
  </select>
  
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from holderretire
    where ID = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from holderretire
    where ID = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.xr.entry.HolderRetire" >
    insert into holderretire (ID, HolderNo, HolderName, 
      SexName, Rank, UnitNo, 
      UnitName, IDCode, StartDate, 
      EndDate,Reason CreateDate, CreatePerson
      )
    values (#{id,jdbcType=INTEGER}, #{holderno,jdbcType=VARCHAR}, #{holdername,jdbcType=VARCHAR}, 
      #{sexname,jdbcType=VARCHAR}, #{rank,jdbcType=VARCHAR}, #{unitno,jdbcType=VARCHAR}, 
      #{unitname,jdbcType=VARCHAR}, #{idcode,jdbcType=VARCHAR}, #{startdate,jdbcType=TIMESTAMP}, 
      #{enddate,jdbcType=TIMESTAMP},#{reason,jdbcType=VARCHAR}, #{createdate,jdbcType=TIMESTAMP}, #{createperson,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.xr.entry.HolderRetire" >
    insert into holderretire
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="holderno != null" >
        HolderNo,
      </if>
      <if test="holdername != null" >
        HolderName,
      </if>
      <if test="sexname != null" >
        SexName,
      </if>
      <if test="rank != null" >
        Rank,
      </if>
      <if test="unitno != null" >
        UnitNo,
      </if>
      <if test="unitname != null" >
        UnitName,
      </if>
      <if test="idcode != null" >
        IDCode,
      </if>
      <if test="startdate != null" >
        StartDate,
      </if>
      <if test="enddate != null" >
        EndDate,
      </if>
       <if test="reason != null" >
        Reason,
      </if>
      <if test="createdate != null" >
        CreateDate,
      </if>
      <if test="createperson != null" >
        CreatePerson,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="holderno != null" >
        #{holderno,jdbcType=VARCHAR},
      </if>
      <if test="holdername != null" >
        #{holdername,jdbcType=VARCHAR},
      </if>
      <if test="sexname != null" >
        #{sexname,jdbcType=VARCHAR},
      </if>
      <if test="rank != null" >
        #{rank,jdbcType=VARCHAR},
      </if>
      <if test="unitno != null" >
        #{unitno,jdbcType=VARCHAR},
      </if>
      <if test="unitname != null" >
        #{unitname,jdbcType=VARCHAR},
      </if>
      <if test="idcode != null" >
        #{idcode,jdbcType=VARCHAR},
      </if>
      <if test="startdate != null" >
        #{startdate,jdbcType=TIMESTAMP},
      </if>
      <if test="enddate != null" >
        #{enddate,jdbcType=TIMESTAMP},
      </if>
      <if test="reason != null" >
        #{reason,jdbcType=VARCHAR},
      </if>
      <if test="createdate != null" >
        #{createdate,jdbcType=TIMESTAMP},
      </if>
      <if test="createperson != null" >
        #{createperson,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xr.entry.HolderRetire" >
    update holderretire
    <set >
      <if test="holderno != null" >
        HolderNo = #{holderno,jdbcType=VARCHAR},
      </if>
      <if test="holdername != null" >
        HolderName = #{holdername,jdbcType=VARCHAR},
      </if>
      <if test="sexname != null" >
        SexName = #{sexname,jdbcType=VARCHAR},
      </if>
      <if test="rank != null" >
        Rank = #{rank,jdbcType=VARCHAR},
      </if>
      <if test="unitno != null" >
        UnitNo = #{unitno,jdbcType=VARCHAR},
      </if>
      <if test="unitname != null" >
        UnitName = #{unitname,jdbcType=VARCHAR},
      </if>
      <if test="idcode != null" >
        IDCode = #{idcode,jdbcType=VARCHAR},
      </if>
      <if test="startdate != null" >
        StartDate = #{startdate,jdbcType=TIMESTAMP},
      </if>
      <if test="enddate != null" >
        EndDate = #{enddate,jdbcType=TIMESTAMP},
      </if>
      <if test="reason != null" >
        Reason = #{reason,jdbcType=VARCHAR},
      </if>
      <if test="createdate != null" >
        CreateDate = #{createdate,jdbcType=TIMESTAMP},
      </if>
      <if test="createperson != null" >
        CreatePerson = #{createperson,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xr.entry.HolderRetire" >
    update holderretire
    set HolderNo = #{holderno,jdbcType=VARCHAR},
      HolderName = #{holdername,jdbcType=VARCHAR},
      SexName = #{sexname,jdbcType=VARCHAR},
      Rank = #{rank,jdbcType=VARCHAR},
      UnitNo = #{unitno,jdbcType=VARCHAR},
      UnitName = #{unitname,jdbcType=VARCHAR},
      IDCode = #{idcode,jdbcType=VARCHAR},
      StartDate = #{startdate,jdbcType=TIMESTAMP},
      EndDate = #{enddate,jdbcType=TIMESTAMP},
      Reason = #{reason,jdbcType=VARCHAR},
      CreateDate = #{createdate,jdbcType=TIMESTAMP},
      CreatePerson = #{createperson,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=INTEGER}
  </update>
</mapper>